grub: intel_iommu=on
mkinitcpio: MODULES="aesni_intel usbhid xhci_hcd i915 nvidia vfio vfio_iommu_type1 vfio_pci vfio_virqfd"
pacman: ovmf

yoda /home/florent
❭ cat /etc/modprobe.d/
kvm.conf     nvidia.conf  vfio.conf    
yoda /home/florent
❭ cat /etc/modprobe.d/nvidia.conf 
blacklist nouveau
#blacklist nvidia
#blacklist nvidia_drm
#blacklist nvidia_modeset
yoda /home/florent
❭ cat /etc/modprobe.d/kvm.conf 
options kvm ignore_msrs=1
yoda /home/florent
❭ cat /etc/modprobe.d/vfio.conf 
#options vfio-pci ids=10de:13c2,10de:0fbb disable_vga=1
options vfio-pci disable_vga=1


<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  <memoryBacking>
    <hugepages/>
  </memoryBacking>
  <vcpu placement='static'>4</vcpu>
  <cputune>
    <vcpupin vcpu='0' cpuset='4'/>
    <vcpupin vcpu='1' cpuset='5'/>
    <vcpupin vcpu='2' cpuset='6'/>
    <vcpupin vcpu='3' cpuset='7'/>
  </cputune>
  <features>
    <hyperv>
      <vendor_id state='on' value='001bba222444'/>
    </hyperv>
    <kvm>
      <hidden state='on'/>
    </kvm>
  </features>
  <qemu:commandline>
    <qemu:env name='QEMU_AUDIO_DRV' value='pa'/>
    <qemu:env name='QEMU_PA_SERVER' value='/run/user/1000/pulse/native'/>
    <qemu:env name='QEMU_AUDIO_TIMER_PERIOD' value=200/>
  </qemu:commandline>
</domain>

+ passthrough usb


Regedit :

Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\PCI\VEN_10DE&DEV_0FBB&SUBSYS_19763842&REV_A1\3&13c0b0c5&0&48\Device Parameters\Interrupt Management\MessageSignaledInterruptProperties
Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\PCI\VEN_10DE&DEV_0FBB&SUBSYS_19763842&REV_A1\4&2d78ab8f&0&0108\Device Parameters\Interrupt Management\MessageSignaledInterruptProperties
Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\PCI\VEN_10DE&DEV_13C2&SUBSYS_19763842&REV_A1\3&13c0b0c5&0&40\Device Parameters\Interrupt Management\MessageSignaledInterruptProperties
Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\PCI\VEN_10DE&DEV_13C2&SUBSYS_19763842&REV_A1\4&2d78ab8f&0&0008\Device Parameters\Interrupt Management\MessageSignaledInterruptProperties

DWORD32 MSISupported 1

$ lspci -vs 1:00.0
01:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] (rev a1) (prog-if 00 [VGA controller])
        ...
        Capabilities: [68] MSI: Enable+ Count=1/1 Maskable- 64bit+
        Kernel driver in use: vfio-pci
        ...

https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF
https://www.reddit.com/r/VFIO/comments/52ya06/return_nvidia_gpu_to_host/
https://arseniyshestakov.com/2016/03/31/how-to-pass-gpu-to-vm-and-back-without-x-restart/
https://fedoraproject.org/wiki/Features/KVM_Huge_Page_Backed_Memory
https://vfio.blogspot.fr/2014/09/vfio-interrupts-and-how-to-coax-windows.html
